-- GGH Chat v3.0 - Рабочий синхронизированный чат для Roblox

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local Player = Players.LocalPlayer

-- Создаем уникальный идентификатор для этого чата
local CHAT_ID = "GGH_CHAT_" .. HttpService:GenerateGUID(false):sub(1, 8)

-- Глобальные данные чата
_G.GGHChatData = _G.GGHChatData or {
    Players = {},
    Messages = {},
    IsInitialized = false
}

local GGHPlayers = _G.GGHChatData.Players
local chatMessages = _G.GGHChatData.Messages

-- Цветовая схема
local ColorScheme = {
    Background = Color3.fromRGB(15, 15, 20),
    Secondary = Color3.fromRGB(25, 25, 35),
    Accent = Color3.fromRGB(0, 180, 255),
    Text = Color3.fromRGB(240, 240, 245),
    Success = Color3.fromRGB(0, 230, 118),
    Warning = Color3.fromRGB(255, 145, 0),
    System = Color3.fromRGB(255, 200, 0)
}

-- Цвета для игроков
local playerColors = {}
for i = 1, 10 do
    local hue = (i * 0.618) % 1  -- Золотое сечение для распределения цветов
    table.insert(playerColors, Color3.fromHSV(hue, 0.7, 0.9))
end

local myColor = playerColors[math.random(1, #playerColors)]
GGHPlayers[Player.Name] = myColor

-- Создаем GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = CHAT_ID
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

-- Главный контейнер
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = ColorScheme.Background
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.6, 0, 0.3, 0)
MainFrame.Size = UDim2.new(0, 450, 0, 550)
MainFrame.Active = true
MainFrame.Draggable = true

-- Закругленные углы
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Тень
local DropShadow = Instance.new("ImageLabel")
DropShadow.Name = "DropShadow"
DropShadow.Parent = MainFrame
DropShadow.BackgroundTransparency = 1
DropShadow.Position = UDim2.new(0, -15, 0, -15)
DropShadow.Size = UDim2.new(1, 30, 1, 30)
DropShadow.ZIndex = -1
DropShadow.Image = "rbxassetid://1316045217"
DropShadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
DropShadow.ImageTransparency = 0.5
DropShadow.ScaleType = Enum.ScaleType.Slice
DropShadow.SliceCenter = Rect.new(50, 50, 250, 250)

-- Верхняя панель
local TopBar = Instance.new("Frame")
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = ColorScheme.Secondary
TopBar.Size = UDim2.new(1, 0, 0, 45)

local TopBarCorner = Instance.new("UICorner")
TopBarCorner.CornerRadius = UDim.new(0, 10)
TopBarCorner.Parent = TopBar

-- Заголовок
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Parent = TopBar
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(0.6, 0, 1, 0)
Title.Position = UDim2.new(0.02, 0, 0, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "GGH CHAT"
Title.TextColor3 = ColorScheme.Accent
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left

local Subtitle = Instance.new("TextLabel")
Subtitle.Name = "Subtitle"
Subtitle.Parent = TopBar
Subtitle.BackgroundTransparency = 1
Subtitle.Size = UDim2.new(0.6, 0, 0.4, 0)
Subtitle.Position = UDim2.new(0.02, 0, 0.6, 0)
Subtitle.Font = Enum.Font.Gotham
Subtitle.Text = "Private Lua Exploiter Network"
Subtitle.TextColor3 = ColorScheme.Text
Subtitle.TextTransparency = 0.3
Subtitle.TextSize = 11
Subtitle.TextXAlignment = Enum.TextXAlignment.Left

-- Кнопки управления
local CloseBtn = Instance.new("TextButton")
CloseBtn.Name = "CloseBtn"
CloseBtn.Parent = TopBar
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(0.93, 0, 0.5, -15)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "×"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 20
CloseBtn.AutoButtonColor = false

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Name = "MinimizeBtn"
MinimizeBtn.Parent = TopBar
MinimizeBtn.BackgroundColor3 = ColorScheme.Secondary
MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)
MinimizeBtn.Position = UDim2.new(0.86, 0, 0.5, -15)
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Text = "_"
MinimizeBtn.TextColor3 = ColorScheme.Text
MinimizeBtn.TextSize = 16
MinimizeBtn.AutoButtonColor = false

-- Панель игроков
local PlayersPanel = Instance.new("Frame")
PlayersPanel.Name = "PlayersPanel"
PlayersPanel.Parent = MainFrame
PlayersPanel.BackgroundColor3 = ColorScheme.Secondary
PlayersPanel.Position = UDim2.new(0.02, 0, 0.1, 0)
PlayersPanel.Size = UDim2.new(0.3, 0, 0.7, 0)

local PlayersCorner = Instance.new("UICorner")
PlayersCorner.CornerRadius = UDim.new(0, 8)
PlayersCorner.Parent = PlayersPanel

local PlayersTitle = Instance.new("TextLabel")
PlayersTitle.Name = "PlayersTitle"
PlayersTitle.Parent = PlayersPanel
PlayersTitle.BackgroundColor3 = ColorScheme.Accent
PlayersTitle.Size = UDim2.new(1, 0, 0, 35)
PlayersTitle.Font = Enum.Font.GothamBold
PlayersTitle.Text = "ONLINE (1)"
PlayersTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayersTitle.TextSize = 14

local PlayersList = Instance.new("ScrollingFrame")
PlayersList.Name = "PlayersList"
PlayersList.Parent = PlayersPanel
PlayersList.BackgroundTransparency = 1
PlayersList.Position = UDim2.new(0, 0, 0, 35)
PlayersList.Size = UDim2.new(1, 0, 1, -35)
PlayersList.ScrollBarThickness = 5
PlayersList.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayersList.AutomaticCanvasSize = Enum.AutomaticSize.Y

local PlayerTemplate = Instance.new("TextLabel")
PlayerTemplate.Name = "PlayerTemplate"
PlayerTemplate.Parent = PlayersList
PlayerTemplate.BackgroundTransparency = 1
PlayerTemplate.Size = UDim2.new(1, -5, 0, 25)
PlayerTemplate.Font = Enum.Font.Gotham
PlayerTemplate.Text = ""
PlayerTemplate.TextColor3 = ColorScheme.Text
PlayerTemplate.TextSize = 13
PlayerTemplate.TextXAlignment = Enum.TextXAlignment.Left
PlayerTemplate.Visible = false

-- Область чата
local ChatArea = Instance.new("Frame")
ChatArea.Name = "ChatArea"
ChatArea.Parent = MainFrame
ChatArea.BackgroundColor3 = ColorScheme.Secondary
ChatArea.Position = UDim2.new(0.34, 0, 0.1, 0)
ChatArea.Size = UDim2.new(0.64, 0, 0.7, 0)

local ChatCorner = Instance.new("UICorner")
ChatCorner.CornerRadius = UDim.new(0, 8)
ChatCorner.Parent = ChatArea

local MessagesContainer = Instance.new("ScrollingFrame")
MessagesContainer.Name = "MessagesContainer"
MessagesContainer.Parent = ChatArea
MessagesContainer.BackgroundTransparency = 1
MessagesContainer.Size = UDim2.new(1, -10, 1, -10)
MessagesContainer.Position = UDim2.new(0, 5, 0, 5)
MessagesContainer.ScrollBarThickness = 8
MessagesContainer.ScrollBarImageColor3 = ColorScheme.Accent
MessagesContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
MessagesContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y

local MessageTemplate = Instance.new("TextLabel")
MessageTemplate.Name = "MessageTemplate"
MessageTemplate.Parent = MessagesContainer
MessageTemplate.BackgroundTransparency = 1
MessageTemplate.Size = UDim2.new(1, -10, 0, 0)
MessageTemplate.Font = Enum.Font.Gotham
MessageTemplate.Text = ""
MessageTemplate.TextColor3 = ColorScheme.Text
MessageTemplate.TextSize = 13
MessageTemplate.TextWrapped = true
MessageTemplate.TextXAlignment = Enum.TextXAlignment.Left
MessageTemplate.RichText = true
MessageTemplate.Visible = false

-- Панель ввода
local InputPanel = Instance.new("Frame")
InputPanel.Name = "InputPanel"
InputPanel.Parent = MainFrame
InputPanel.BackgroundColor3 = ColorScheme.Secondary
InputPanel.Position = UDim2.new(0.02, 0, 0.82, 0)
InputPanel.Size = UDim2.new(0.96, 0, 0.15, 0)

local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 8)
InputCorner.Parent = InputPanel

local ChatInput = Instance.new("TextBox")
ChatInput.Name = "ChatInput"
ChatInput.Parent = InputPanel
ChatInput.BackgroundColor3 = ColorScheme.Background
ChatInput.Position = UDim2.new(0.02, 0, 0.15, 0)
ChatInput.Size = UDim2.new(0.75, 0, 0.7, 0)
ChatInput.Font = Enum.Font.Gotham
ChatInput.PlaceholderColor3 = ColorScheme.Text
ChatInput.PlaceholderText = "Type message..."
ChatInput.Text = ""
ChatInput.TextColor3 = ColorScheme.Text
ChatInput.TextSize = 14
ChatInput.TextXAlignment = Enum.TextXAlignment.Left

local InputCorner2 = Instance.new("UICorner")
InputCorner2.CornerRadius = UDim.new(0, 6)
InputCorner2.Parent = ChatInput

local SendButton = Instance.new("TextButton")
SendButton.Name = "SendButton"
SendButton.Parent = InputPanel
SendButton.BackgroundColor3 = ColorScheme.Accent
SendButton.Position = UDim2.new(0.78, 0, 0.15, 0)
SendButton.Size = UDim2.new(0.2, 0, 0.7, 0)
SendButton.Font = Enum.Font.GothamBold
SendButton.Text = "SEND"
SendButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SendButton.TextSize = 14
SendButton.AutoButtonColor = false

local SendCorner = Instance.new("UICorner")
SendCorner.CornerRadius = UDim.new(0, 6)
SendCorner.Parent = SendButton

-- Минимизированная версия
local MinimizedFrame = Instance.new("Frame")
MinimizedFrame.Name = "MinimizedFrame"
MinimizedFrame.Parent = ScreenGui
MinimizedFrame.BackgroundColor3 = ColorScheme.Accent
MinimizedFrame.Position = MainFrame.Position
MinimizedFrame.Size = UDim2.new(0, 150, 0, 40)
MinimizedFrame.Active = true
MinimizedFrame.Draggable = true
MinimizedFrame.Visible = false

local MinimizedCorner = Instance.new("UICorner")
MinimizedCorner.CornerRadius = UDim.new(0, 8)
MinimizedCorner.Parent = MinimizedFrame

local OpenButton = Instance.new("TextButton")
OpenButton.Name = "OpenButton"
OpenButton.Parent = MinimizedFrame
OpenButton.BackgroundTransparency = 1
OpenButton.Size = UDim2.new(1, 0, 1, 0)
OpenButton.Font = Enum.Font.GothamBold
OpenButton.Text = "GGH CHAT"
OpenButton.TextColor3 = Color3.fromRGB(255, 255, 255)
OpenButton.TextSize = 14

-- Статус бар
local StatusBar = Instance.new("Frame")
StatusBar.Name = "StatusBar"
StatusBar.Parent = MainFrame
StatusBar.BackgroundColor3 = ColorScheme.Secondary
StatusBar.Position = UDim2.new(0, 0, 0.97, 0)
StatusBar.Size = UDim2.new(1, 0, 0.03, 0)

local StatusText = Instance.new("TextLabel")
StatusText.Name = "StatusText"
StatusText.Parent = StatusBar
StatusText.BackgroundTransparency = 1
StatusText.Size = UDim2.new(1, 0, 1, 0)
StatusText.Font = Enum.Font.Gotham
StatusText.Text = "Connected • GGH Chat v3.0"
StatusText.TextColor3 = ColorScheme.Accent
StatusText.TextSize = 11
StatusText.TextXAlignment = Enum.TextXAlignment.Left
StatusText.Position = UDim2.new(0.02, 0, 0, 0)

-- Функции для глобальной синхронизации
local function broadcastToAllPlayers(action, data)
    -- Ищем всех игроков с GGH Chat
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= Player then
            local otherGui = otherPlayer:FindFirstChild("PlayerGui") or game:GetService("CoreGui")
            local otherChat = otherGui:FindFirstChild(CHAT_ID)
            
            if otherChat then
                -- Используем BindableEvents для межклиентской связи
                local event = otherChat:FindFirstChild("GGH_BindableEvent")
                if event then
                    pcall(function()
                        event:Fire(action, data)
                    end)
                end
            end
        end
    end
end

-- Создаем BindableEvent для получения сообщений от других игроков
local BindableEvent = Instance.new("BindableEvent")
BindableEvent.Name = "GGH_BindableEvent"
BindableEvent.Parent = ScreenGui

-- Функции
local function calculateTextHeight(text, fontSize, frameWidth)
    local TextService = game:GetService("TextService")
    local textSize = TextService:GetTextSize(
        text,
        fontSize,
        Enum.Font.Gotham,
        Vector2.new(frameWidth - 20, math.huge)
    )
    return math.max(20, textSize.Y + 5)
end

local function addMessageToChat(sender, message, isSystem, color)
    if not MessagesContainer then return end
    
    local timestamp = os.date("%H:%M:%S")
    local displayName = isSystem and "SYSTEM" or sender
    local textColor = isSystem and ColorScheme.System or (color or ColorScheme.Accent)
    
    -- Форматируем сообщение
    local formattedText
    if isSystem then
        formattedText = string.format(
            '<font color="rgb(%d,%d,%d)">[%s] %s:</font> %s',
            math.floor(ColorScheme.System.R * 255),
            math.floor(ColorScheme.System.G * 255),
            math.floor(ColorScheme.System.B * 255),
            timestamp,
            displayName,
            message
        )
    else
        formattedText = string.format(
            '[%s] <font color="rgb(%d,%d,%d)">%s:</font> %s',
            timestamp,
            math.floor(textColor.R * 255),
            math.floor(textColor.G * 255),
            math.floor(textColor.B * 255),
            displayName,
            message
        )
    end
    
    local newMessage = MessageTemplate:Clone()
    newMessage.Parent = MessagesContainer
    newMessage.Visible = true
    newMessage.Text = formattedText
    newMessage.TextColor3 = isSystem and ColorScheme.System or ColorScheme.Text
    newMessage.RichText = true
    
    local messageHeight = calculateTextHeight(
        string.format("[%s] %s: %s", timestamp, displayName, message),
        13,
        MessagesContainer.AbsoluteSize.X - 20
    )
    
    newMessage.Size = UDim2.new(1, -10, 0, messageHeight)
    
    -- Позиционируем сообщения друг под другом
    local totalHeight = 5
    local children = MessagesContainer:GetChildren()
    
    for _, child in ipairs(children) do
        if child:IsA("TextLabel") and child ~= MessageTemplate and child ~= newMessage then
            totalHeight = totalHeight + child.Size.Y.Offset + 5
        end
    end
    
    newMessage.Position = UDim2.new(0, 5, 0, totalHeight)
    
    -- Обновляем CanvasSize
    MessagesContainer.CanvasSize = UDim2.new(0, 0, 0, totalHeight + messageHeight + 10)
    
    -- Автопрокрутка к последнему сообщению
    wait(0.05)
    MessagesContainer.CanvasPosition = Vector2.new(0, MessagesContainer.CanvasSize.Y.Offset)
    
    -- Сохраняем сообщение
    table.insert(chatMessages, {
        sender = sender,
        message = message,
        timestamp = timestamp,
        isSystem = isSystem,
        color = textColor,
        height = messageHeight
    })
end

local function sendChatMessage(message)
    if not message or #message == 0 then return end
    if #message > 200 then
        addMessageToChat("SYSTEM", "Message too long (max 200 chars)", true)
        return
    end
    
    -- Локальное отображение
    addMessageToChat(Player.Name, message, false, myColor)
    
    -- Рассылка другим игрокам
    broadcastToAllPlayers("GGH_Message", {
        Sender = Player.Name,
        Message = message,
        Color = myColor,
        Timestamp = os.date("%H:%M:%S")
    })
    
    ChatInput.Text = ""
    ChatInput:CaptureFocus()
end

local function updatePlayersList()
    if not PlayersList then return end
    
    -- Очищаем список
    for _, child in ipairs(PlayersList:GetChildren()) do
        if child:IsA("TextLabel") and child ~= PlayerTemplate then
            child:Destroy()
        end
    end
    
    local yOffset = 0
    
    -- Добавляем себя
    local myEntry = PlayerTemplate:Clone()
    myEntry.Parent = PlayersList
    myEntry.Visible = true
    myEntry.Text = Player.Name .. " (You)"
    myEntry.TextColor3 = myColor
    myEntry.Position = UDim2.new(0, 5, 0, yOffset)
    yOffset = yOffset + 25
    
    -- Добавляем других игроков
    local onlineCount = 1
    for playerName, color in pairs(GGHPlayers) do
        if playerName ~= Player.Name then
            onlineCount = onlineCount + 1
            
            local playerEntry = PlayerTemplate:Clone()
            playerEntry.Parent = PlayersList
            playerEntry.Visible = true
            playerEntry.Text = playerName
            playerEntry.TextColor3 = color
            playerEntry.Position = UDim2.new(0, 5, 0, yOffset)
            yOffset = yOffset + 25
        end
    end
    
    -- Обновляем заголовок
    PlayersTitle.Text = string.format("ONLINE (%d)", onlineCount - 1)
    
    -- Обновляем CanvasSize
    PlayersList.CanvasSize = UDim2.new(0, 0, 0, yOffset)
end

local function addPlayer(playerName, color)
    if playerName == Player.Name then return end
    
    if not GGHPlayers[playerName] then
        local assignedColor = color or playerColors[(#GGHPlayers % #playerColors) + 1]
        GGHPlayers[playerName] = assignedColor
        
        -- Уведомление о присоединении
        addMessageToChat("SYSTEM", string.format("%s joined GGH Chat", playerName), true)
        
        updatePlayersList()
    end
end

local function removePlayer(playerName)
    if GGHPlayers[playerName] then
        GGHPlayers[playerName] = nil
        addMessageToChat("SYSTEM", string.format("%s left GGH Chat", playerName), true)
        updatePlayersList()
    end
end

local function toggleMinimize()
    if isMinimized then
        -- Разворачиваем
        MainFrame.Visible = true
        MinimizedFrame.Visible = false
        isMinimized = false
    else
        -- Сворачиваем
        MainFrame.Visible = false
        MinimizedFrame.Visible = true
        MinimizedFrame.Position = MainFrame.Position
        MinimizedFrame.Size = UDim2.new(0, 150, 0, 40)
        isMinimized = true
    end
end

local function clearChat()
    for _, child in ipairs(MessagesContainer:GetChildren()) do
        if child:IsA("TextLabel") and child ~= MessageTemplate then
            child:Destroy()
        end
    end
    chatMessages = {}
    addMessageToChat("SYSTEM", "Chat cleared", true)
end

-- Поиск других игроков с GGH Chat
local function discoverOtherPlayers()
    while wait(5) and ScreenGui.Parent do
        -- Отправляем ping другим игрокам
        broadcastToAllPlayers("GGH_Ping", {
            Sender = Player.Name,
            Color = myColor,
            Time = os.time()
        })
        
        -- Обновляем статус
        StatusText.Text = string.format("Connected • %d players online", #Players:GetPlayers())
    end
end

-- Обработчик входящих сообщений
BindableEvent.Event:Connect(function(action, data)
    if action == "GGH_Message" then
        if data.Sender and data.Message then
            addPlayer(data.Sender, data.Color)
            addMessageToChat(data.Sender, data.Message, false, data.Color)
        end
    elseif action == "GGH_Ping" then
        if data.Sender and data.Sender ~= Player.Name then
            addPlayer(data.Sender, data.Color)
        end
    elseif action == "GGH_Join" then
        if data.Sender then
            addPlayer(data.Sender, data.Color)
        end
    elseif action == "GGH_Leave" then
        if data.Sender then
            removePlayer(data.Sender)
        end
    end
end)

-- Привязка событий
SendButton.MouseButton1Click:Connect(function()
    sendChatMessage(ChatInput.Text)
end)

ChatInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        sendChatMessage(ChatInput.Text)
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    broadcastToAllPlayers("GGH_Leave", {Sender = Player.Name})
    ScreenGui:Destroy()
end)

MinimizeBtn.MouseButton1Click:Connect(toggleMinimize)
OpenButton.MouseButton1Click:Connect(toggleMinimize)

-- Горячие клавиши
game:GetService("UserInputService").InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Slash then
        ChatInput:CaptureFocus()
    elseif input.KeyCode == Enum.KeyCode.Return and ChatInput:IsFocused() then
        sendChatMessage(ChatInput.Text)
    elseif input.KeyCode == Enum.KeyCode.Escape then
        ChatInput:ReleaseFocus()
    end
end)

-- Анимации кнопок
local function setupButtonHover(button, normalColor, hoverColor)
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = hoverColor
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = normalColor
    end)
end

setupButtonHover(CloseBtn, Color3.fromRGB(255, 60, 60), Color3.fromRGB(255, 80, 80))
setupButtonHover(MinimizeBtn, ColorScheme.Secondary, ColorScheme.Accent)
setupButtonHover(SendButton, ColorScheme.Accent, Color3.fromRGB(0, 200, 255))

-- Инициализация
addMessageToChat("SYSTEM", "GGH Chat v3.0 initialized!", true)
addMessageToChat("SYSTEM", "Welcome to private exploiter network!", true)
addMessageToChat("SYSTEM", "Type / to focus chat, press Enter to send", true)

-- Обновляем список игроков
updatePlayersList()

-- Запускаем обнаружение игроков
spawn(discoverOtherPlayers)

-- Автоматическая регистрация
spawn(function()
    wait(1)
    broadcastToAllPlayers("GGH_Join", {
        Sender = Player.Name,
        Color = myColor
    })
end)

-- Тестовое сообщение
spawn(function()
    wait(3)
    addMessageToChat("SYSTEM", "Scanning for other GGH users...", true)
    wait(2)
    addMessageToChat("SYSTEM", "Network ready. Messages will sync automatically.", true)
end)

print("========================================")
print("GGH Chat v3.0 ACTIVE")
print("Chat ID: " .. CHAT_ID)
print("Your color: " .. tostring(myColor))
print("Players will auto-discover each other")
print("========================================")

-- Экспортируем функции для внешнего доступа
return {
    SendMessage = sendChatMessage,
    AddPlayer = addPlayer,
    RemovePlayer = removePlayer,
    ClearChat = clearChat,
    GetPlayers = function() return GGHPlayers end,
    GetMessages = function() return chatMessages end
}
